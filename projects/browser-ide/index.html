<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>miniIDE Â· browser code studio</title>
  <!-- google fonts + font awesome for clean look -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #1e1f2c;
      font-family: 'Inter', sans-serif;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .ide-container {
      width: 1400px; max-width: 100%; height: 100%; max-height: 900px;
      background: #2d2f3f; border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05) inset;
      display: flex; flex-direction: column; overflow: hidden;
      backdrop-filter: blur(2px);
    }
    .ide-header {
      background: #252734; padding: 12px 20px;
      display: flex; align-items: center; gap: 16px;
      border-bottom: 1px solid #1b1c26;
    }
    .logo-area {
      display: flex; align-items: center; gap: 8px;
      color: #c0c4e0; font-weight: 500; letter-spacing: 0.2px;
    }
    .logo-area i { font-size: 1.3rem; color: #7aa2f7; }
    .file-tabs {
      display: flex; gap: 2px; background: #1e1f2c;
      padding: 4px 6px; border-radius: 12px;
    }
    .file-tab {
      background: transparent; border: none; color: #9aa5ce;
      font-family: 'Inter', sans-serif; font-size: 0.85rem; font-weight: 500;
      padding: 6px 14px; border-radius: 8px; display: flex; align-items: center; gap: 8px;
      cursor: pointer; transition: all 0.15s;
    }
    .file-tab i { font-size: 0.8rem; color: #7dcfff; }
    .file-tab.html-tab i { color: #e34c26; }
    .file-tab.css-tab i { color: #2965f1; }
    .file-tab.js-tab i { color: #f7df1e; }
    .file-tab.active { background: #2d2f3f; color: white; box-shadow: 0 2px 6px rgba(0,0,0,0.4); }
    .file-tab:not(.active):hover { background: #35384a; color: #e1e6ff; }
    .spacer { flex: 1; }
    .action-btns { display: flex; gap: 12px; }
    .action-btns button {
      background: none; border: none; color: #abb2d9; font-size: 1.1rem;
      padding: 6px 8px; border-radius: 10px; cursor: pointer; transition: 0.1s;
    }
    .action-btns button:hover { background: #3c4058; color: white; }
    .run-btn {
      background: #41a6b5 !important; color: white !important;
      padding: 6px 18px !important; border-radius: 30px !important; font-weight: 600;
      font-size: 0.9rem !important; display: flex; align-items: center; gap: 6px;
      box-shadow: 0 4px 10px rgba(65, 166, 181, 0.3);
    }
    .run-btn i { font-size: 0.9rem; }
    .editor-panels {
      display: flex; flex: 1; min-height: 0; gap: 12px;
      padding: 16px 16px 12px 16px; background: #1a1c26;
    }
    .panel {
      background: #252734; border-radius: 18px; display: flex; flex-direction: column;
      overflow: hidden; box-shadow: 0 8px 16px rgba(0,0,0,0.5);
      border: 1px solid #373a4b; flex: 1; min-width: 0;
    }
    .panel-header {
      padding: 12px 16px; background: #2d2f3f; border-bottom: 1px solid #1e202b;
      display: flex; align-items: center; gap: 8px; color: #b7c0e0;
      font-weight: 500; font-size: 0.8rem; letter-spacing: 0.4px; text-transform: uppercase;
    }
    .panel-header i { font-size: 1rem; }
    .html-panel .panel-header i { color: #e34c26; }
    .css-panel .panel-header i { color: #2965f1; }
    .js-panel .panel-header i { color: #f7df1e; }
    .code-input {
      width: 100%; flex: 1; background: #1b1d29; border: none; outline: none;
      color: #e5e9f0; font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
      line-height: 1.6; padding: 18px 16px; resize: none; white-space: pre; overflow: auto;
      tab-size: 2;
    }
    .code-input::placeholder { color: #4f5270; font-style: italic; opacity: 0.7; }
    .output-section {
      background: #252734; border-top: 2px solid #323544; height: 260px;
      display: flex; flex-direction: column; border-radius: 18px 18px 0 0;
      margin: 0 16px 16px 16px; box-shadow: 0 -4px 10px rgba(0,0,0,0.5);
    }
    .output-tabs {
      display: flex; gap: 20px; padding: 0 20px; background: #2b2d3b;
      border-radius: 14px 14px 0 0; border-bottom: 1px solid #20222e;
    }
    .output-tab {
      background: transparent; border: none; padding: 12px 4px; font-size: 0.85rem;
      font-weight: 500; color: #8188b0; display: flex; align-items: center; gap: 6px;
      border-bottom: 2px solid transparent; cursor: pointer;
    }
    .output-tab.active { color: #b3f0ff; border-bottom: 2px solid #7aa2f7; }
    .output-content { flex: 1; background: #1f212e; position: relative; }
    .preview-frame { width: 100%; height: 100%; border: none; background: white; }
    .console-pane {
      width: 100%; height: 100%; color: #d8dee9; font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem; padding: 14px 18px; overflow-y: auto; background: #1b1d29;
      display: none; white-space: pre-wrap;
    }
    .console-pane.visible { display: block; }
    .console-line { padding: 4px 0; border-bottom: 1px solid #2d303e; color: #b3c5e5; }
    .console-line.error { color: #f28b8b; }
    .console-line i { margin-right: 8px; width: 16px; }
    .status-bar {
      background: #1e1f2c; padding: 8px 24px; font-size: 0.75rem; color: #6d739b;
      display: flex; gap: 24px; border-top: 1px solid #0e0f16;
    }
    .status-item i { margin-right: 6px; }
    .code-input::-webkit-scrollbar { width: 8px; height: 8px; }
    .code-input::-webkit-scrollbar-track { background: #1a1c26; }
    .code-input::-webkit-scrollbar-thumb { background: #434761; border-radius: 8px; }
    .console-pane::-webkit-scrollbar { width: 6px; }
    .console-pane::-webkit-scrollbar-thumb { background: #4c5177; border-radius: 12px; }
  </style>
</head>
<body>
<div class="ide-container">
  <!-- header with fake files -->
  <div class="ide-header">
    <div class="logo-area"><i class="fas fa-code"></i><span>miniIDE Â· live codes</span></div>
    <div class="file-tabs">
      <button class="file-tab html-tab active" id="tabHtmlBtn"><i class="fab fa-html5"></i> index.html</button>
      <button class="file-tab css-tab" id="tabCssBtn"><i class="fab fa-css3-alt"></i> style.css</button>
      <button class="file-tab js-tab" id="tabJsBtn"><i class="fab fa-js"></i> script.js</button>
    </div>
    <div class="spacer"></div>
    <div class="action-btns">
      <button id="refreshPreviewBtn" title="reload preview"><i class="fas fa-sync-alt"></i></button>
      <button id="clearConsoleBtn" title="clear console"><i class="fas fa-eraser"></i></button>
      <button class="run-btn" id="runCodeBtn"><i class="fas fa-play"></i> RUN</button>
    </div>
  </div>

  <!-- 3 code panels (always visible) -->
  <div class="editor-panels">
    <!-- HTML panel -->
    <div class="panel html-panel">
      <div class="panel-header"><i class="fab fa-html5"></i> HTML</div>
      <textarea id="htmlInput" class="code-input" placeholder="&lt;!-- write HTML here --&gt;" spellcheck="false">&lt;div class="card"&gt;
  &lt;h2&gt;âœ¨ interactive demo&lt;/h2&gt;
  &lt;p&gt;Edit code and click RUN or use Ctrl+Enter&lt;/p&gt;
  &lt;button id="testBtn"&gt;click me&lt;/button&gt;
&lt;/div&gt;</textarea>
    </div>
    <!-- CSS panel -->
    <div class="panel css-panel">
      <div class="panel-header"><i class="fab fa-css3-alt"></i> CSS</div>
      <textarea id="cssInput" class="code-input" placeholder="/* write CSS here */" spellcheck="false">body {
  background: linear-gradient(145deg, #1b2b4e, #1e3a5f);
  display: flex; align-items: center; justify-content: center;
  min-height: 100vh; font-family: system-ui, 'Inter', sans-serif;
  margin: 0; padding: 16px;
}
.card {
  background: rgba(255,255,255,0.1); backdrop-filter: blur(8px);
  border-radius: 32px; padding: 2rem 2.5rem;
  box-shadow: 0 20px 40px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.2) inset;
  color: white; text-align: center; border: 1px solid rgba(255,255,240,0.2);
  width: 380px;
}
.card h2 { font-weight: 500; margin-bottom: 0.5rem; color: #cfe2ff; }
.card p { color: #b0c6e9; margin-bottom: 1.8rem; font-size: 0.95rem; }
button {
  background: #7aa2f7; border: none; color: #0e1a2b; font-weight: 600;
  padding: 10px 28px; border-radius: 50px; font-size: 1rem; cursor: pointer;
  transition: 0.15s; box-shadow: 0 4px 0 #3d5a9b;
}
button:hover { background: #9bb9ff; transform: translateY(-2px); box-shadow: 0 6px 0 #3d5a9b; }
button:active { transform: translateY(2px); box-shadow: 0 2px 0 #3d5a9b; }</textarea>
    </div>
    <!-- JS panel -->
    <div class="panel js-panel">
      <div class="panel-header"><i class="fab fa-js"></i> JavaScript</div>
      <textarea id="jsInput" class="code-input" placeholder="// write JavaScript here" spellcheck="false">document.getElementById('testBtn')?.addEventListener('click', function() {
  console.log('ðŸŽ¯ button clicked! interactive console works.');
  alert('hello from miniIDE ðŸ‘‹');
});
// your live code runs in a sandboxed iframe
console.log('ðŸ§  script loaded, ready to log.');</textarea>
    </div>
  </div>

  <!-- output + console panel -->
  <div class="output-section">
    <div class="output-tabs">
      <button class="output-tab active" id="previewTabBtn"><i class="fas fa-eye"></i> preview</button>
      <button class="output-tab" id="consoleTabBtn"><i class="fas fa-terminal"></i> console</button>
    </div>
    <div class="output-content">
      <!-- preview iframe -->
      <iframe id="previewFrame" class="preview-frame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups" title="live preview"></iframe>
      <!-- console pane (hidden by default) -->
      <div id="consolePane" class="console-pane"></div>
    </div>
  </div>

  <!-- tiny status bar -->
  <div class="status-bar">
    <span class="status-item"><i class="far fa-save"></i> autosave on run</span>
    <span class="status-item"><i class="fas fa-bolt"></i> ctrl+enter run</span>
    <span class="status-item"><i class="far fa-clock"></i> live preview</span>
  </div>
</div>

<script>
(function() {
  // ----- get DOM elements -----
  const htmlInput = document.getElementById('htmlInput');
  const cssInput = document.getElementById('cssInput');
  const jsInput = document.getElementById('jsInput');
  const previewFrame = document.getElementById('previewFrame');
  const consolePane = document.getElementById('consolePane');
  const runBtn = document.getElementById('runCodeBtn');
  const refreshBtn = document.getElementById('refreshPreviewBtn');
  const clearConsoleBtn = document.getElementById('clearConsoleBtn');
  const previewTabBtn = document.getElementById('previewTabBtn');
  const consoleTabBtn = document.getElementById('consoleTabBtn');
  const htmlTabBtn = document.getElementById('tabHtmlBtn');
  const cssTabBtn = document.getElementById('tabCssBtn');
  const jsTabBtn = document.getElementById('tabJsBtn');

  // ----- state -----
  let consoleEntries = [];             // stored as HTML strings
  let activeOutput = 'preview';        // 'preview' or 'console'

  // ----- helper: escape for safe console display -----
  function escapeHtml(unsafe) {
    return unsafe.replace(/[&<>"]/g, function(m) {
      if (m === '&') return '&amp;';
      if (m === '<') return '&lt;';
      if (m === '>') return '&gt;';
      if (m === '"') return '&quot;';
      return m;
    });
  }

  // ----- add a message to console store and re-render -----
  function addConsoleMessage(text, isError = false) {
    const icon = isError ? 'fa-circle-exclamation' : 'fa-chevron-right';
    const cls = isError ? 'error' : '';
    const lineHtml = `<div class="console-line ${cls}"><i class="fas ${icon}"></i> ${escapeHtml(text)}</div>`;
    consoleEntries.push(lineHtml);
    if (consoleEntries.length > 100) consoleEntries.shift();  // keep reasonable
    renderConsole();
  }

  // ----- render console pane from stored entries -----
  function renderConsole() {
    if (consoleEntries.length === 0) {
      consolePane.innerHTML = '<div class="console-line"><i class="fas fa-info-circle"></i> [console empty]</div>';
    } else {
      consolePane.innerHTML = consoleEntries.join('');
    }
  }

  // ----- clear console -----
  function clearConsole() {
    consoleEntries = [];
    addConsoleMessage('console cleared Â· ready', false);
  }

  // ----- generate iframe srcdoc from editor values (FIXED: no template literal issues) -----
  function generatePreviewDocument() {
    const htmlRaw = htmlInput.value;
    const cssRaw = cssInput.value;
    const jsRaw = jsInput.value;

    // Build the injected script that overrides console and forwards to parent.
    // Must be a plain string without using `</script>` inside that would close the parent script.
    // We'll use string concatenation to avoid accidental closing.
    const forwardScript = 
      '<script>\n' +
      '(function() {\n' +
      '  const originalConsole = window.console;\n' +
      '  function sendLog(level, args) {\n' +
      '    try {\n' +
      '      const strings = Array.from(args).map(arg => {\n' +
      '        try { return String(arg); } catch { return "[unstringable]"; }\n' +
      '      }).join(" ");\n' +
      '      window.parent.postMessage({ type: "console", level: level, message: strings }, "*");\n' +
      '    } catch (e) {}\n' +
      '  }\n' +
      '  window.console = {\n' +
      '    log: function(...args) { sendLog("log", args); originalConsole.log(...args); },\n' +
      '    info: function(...args) { sendLog("info", args); originalConsole.info(...args); },\n' +
      '    warn: function(...args) { sendLog("warn", args); originalConsole.warn(...args); },\n' +
      '    error: function(...args) { sendLog("error", args); originalConsole.error(...args); },\n' +
      '    debug: function(...args) { sendLog("debug", args); originalConsole.debug(...args); }\n' +
      '  };\n' +
      '  window.addEventListener("error", function(e) {\n' +
      '    sendLog("error", ["Uncaught:", e.message, "at", e.filename + ":" + e.lineno]);\n' +
      '  });\n' +
      '})();\n' +
      '<\/script>';  // escaped closing tag to not break out of parent script

    return '<!DOCTYPE html>\n' +
      '<html>\n' +
      '<head>\n' +
      '  <meta charset="UTF-8">\n' +
      '  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n' +
      '  <style>' + cssRaw + '</style>\n' +
      '  <style>body { margin: 0; }</style>\n' +
      '</head>\n' +
      '<body>\n' +
      '  ' + htmlRaw + '\n' +
      '  ' + forwardScript + '\n' +
      '  <script>' + jsRaw + '<\/script>\n' +
      '</body>\n' +
      '</html>';
  }

  // ----- update preview iframe -----
  function updatePreview() {
    const doc = generatePreviewDocument();
    previewFrame.srcdoc = doc;
    addConsoleMessage('â–¶ preview updated at ' + new Date().toLocaleTimeString(), false);
  }

  // ----- listen to console messages from iframe -----
  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'console') {
      const level = event.data.level || 'log';
      const msg = event.data.message || '[empty]';
      let prefix = '';
      if (level === 'warn') prefix = 'âš ï¸ ';
      else if (level === 'error') prefix = 'âŒ ';
      else if (level === 'info') prefix = 'â„¹ï¸ ';
      addConsoleMessage(prefix + msg, level === 'error');
    }
  });

  // ----- switch between preview and console tabs -----
  function setOutputTab(tab) {
    if (tab === 'preview') {
      previewTabBtn.classList.add('active');
      consoleTabBtn.classList.remove('active');
      previewFrame.style.display = 'block';
      consolePane.classList.remove('visible');
      activeOutput = 'preview';
    } else {
      previewTabBtn.classList.remove('active');
      consoleTabBtn.classList.add('active');
      previewFrame.style.display = 'none';
      consolePane.classList.add('visible');
      activeOutput = 'console';
    }
  }
  previewTabBtn.addEventListener('click', () => setOutputTab('preview'));
  consoleTabBtn.addEventListener('click', () => setOutputTab('console'));

  // ----- file tabs UI + focus (no panel hiding) -----
  function setActiveFileTab(activeId) {
    [htmlTabBtn, cssTabBtn, jsTabBtn].forEach(btn => btn.classList.remove('active'));
    if (activeId === 'html') htmlTabBtn.classList.add('active');
    if (activeId === 'css') cssTabBtn.classList.add('active');
    if (activeId === 'js') jsTabBtn.classList.add('active');
  }
  htmlTabBtn.addEventListener('click', () => { setActiveFileTab('html'); htmlInput.focus(); });
  cssTabBtn.addEventListener('click', () => { setActiveFileTab('css'); cssInput.focus(); });
  jsTabBtn.addEventListener('click', () => { setActiveFileTab('js'); jsInput.focus(); });

  // ----- run buttons and keyboard shortcut -----
  runBtn.addEventListener('click', updatePreview);
  refreshBtn.addEventListener('click', () => {
    updatePreview();
    addConsoleMessage('âŸ³ preview manually refreshed', false);
  });
  clearConsoleBtn.addEventListener('click', clearConsole);

  // Ctrl+Enter run
  [htmlInput, cssInput, jsInput].forEach(textarea => {
    textarea.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        updatePreview();
      }
    });
  });

  // ----- initial load -----
  window.addEventListener('load', () => {
    // initialize console with a ready message
    consoleEntries = [];
    addConsoleMessage('ðŸ‘‹ miniIDE ready Â· logs from iframe appear here', false);
    updatePreview();
    setActiveFileTab('html');
  });

  // ----- parent error fallback (optional) -----
  window.onerror = function(msg, src, line) {
    addConsoleMessage('[parent error] ' + msg + ' at ' + src + ':' + line, true);
  };
})();
</script>
<!-- no stray JS prints â€“ everything is inside the script block -->
</body>
</html>