<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compliance Deviation Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1>‚öñÔ∏è Compliance Deviation Tracker</h1>
                <p class="subtitle">Autonomous monitoring of operational workflows against regulatory standards</p>
            </div>
            <div class="header-controls">
                <button id="startMonitoring" class="btn btn-primary">Start Monitoring</button>
                <button id="scanNow" class="btn btn-secondary">Scan Now</button>
                <button id="exportReport" class="btn btn-tertiary">Export Report</button>
            </div>
        </header>

        <main class="main-content">
            <!-- Compliance Overview Cards -->
            <section class="compliance-overview">
                <div class="compliance-card compliant">
                    <div class="card-icon">‚úì</div>
                    <div class="card-info">
                        <h3>Compliant</h3>
                        <p class="card-value" id="compliantCount">0</p>
                        <p class="card-label">Workflows</p>
                    </div>
                </div>
                <div class="compliance-card deviations">
                    <div class="card-icon">‚ö†</div>
                    <div class="card-info">
                        <h3>Deviations</h3>
                        <p class="card-value" id="deviationCount">0</p>
                        <p class="card-label">Found</p>
                    </div>
                </div>
                <div class="compliance-card score">
                    <div class="card-icon">üìä</div>
                    <div class="card-info">
                        <h3>Compliance Score</h3>
                        <p class="card-value" id="complianceScore">100%</p>
                        <p class="card-label">Overall</p>
                    </div>
                </div>
                <div class="compliance-card critical">
                    <div class="card-icon">üö®</div>
                    <div class="card-info">
                        <h3>Critical Issues</h3>
                        <p class="card-value" id="criticalCount">0</p>
                        <p class="card-label">Require Action</p>
                    </div>
                </div>
            </section>

            <!-- Tabs Navigation -->
            <section class="tabs-section">
                <button class="tab-button active" data-tab="dashboard">Dashboard</button>
                <button class="tab-button" data-tab="deviations">Deviations</button>
                <button class="tab-button" data-tab="workflows">Workflows</button>
                <button class="tab-button" data-tab="frameworks">Frameworks</button>
                <button class="tab-button" data-tab="audit">Audit Trail</button>
            </section>

            <!-- Dashboard Tab -->
            <section id="dashboard" class="tab-content active">
                <div class="section-title">Real-Time Compliance Monitoring</div>
                
                <div class="monitoring-status">
                    <div class="status-panel">
                        <h3>Monitoring Status</h3>
                        <div class="status-indicator">
                            <span class="status-dot" id="statusDot"></span>
                            <span id="monitoringStatus">Stopped</span>
                        </div>
                        <div class="status-details">
                            <div class="status-item">
                                <span class="label">Last Scan:</span>
                                <span class="value" id="lastScan">Never</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Workflows Monitored:</span>
                                <span class="value" id="monitoredWorkflows">0</span>
                            </div>
                            <div class="status-item">
                                <span class="label">Active Rules:</span>
                                <span class="value" id="activeRules">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="status-panel">
                        <h3>Framework Coverage</h3>
                        <div id="frameworkCoverage" class="framework-list">
                            <div class="placeholder">Loading frameworks...</div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Compliance Trend (Last 24 Hours)</h3>
                    <canvas id="complianceChart" class="chart-canvas"></canvas>
                </div>

                <div class="recent-activity">
                    <h3>Recent Deviations</h3>
                    <div id="recentDeviations" class="activity-list">
                        <div class="placeholder">No recent deviations</div>
                    </div>
                </div>
            </section>

            <!-- Deviations Tab -->
            <section id="deviations" class="tab-content">
                <div class="section-title">Compliance Deviations</div>
                
                <div class="filter-controls">
                    <select id="severityFilter" class="filter-select">
                        <option value="all">All Severities</option>
                        <option value="critical">Critical</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                    <select id="frameworkFilter" class="filter-select">
                        <option value="all">All Frameworks</option>
                        <option value="gdpr">GDPR</option>
                        <option value="hipaa">HIPAA</option>
                        <option value="sox">SOX</option>
                        <option value="pci-dss">PCI-DSS</option>
                    </select>
                    <select id="statusFilter" class="filter-select">
                        <option value="all">All Statuses</option>
                        <option value="open">Open</option>
                        <option value="acknowledged">Acknowledged</option>
                        <option value="resolved">Resolved</option>
                    </select>
                </div>

                <div id="deviationsList" class="deviations-list">
                    <div class="placeholder">No deviations found</div>
                </div>
            </section>

            <!-- Workflows Tab -->
            <section id="workflows" class="tab-content">
                <div class="section-title">Monitored Workflows</div>
                
                <div class="workflows-grid" id="workflowsGrid">
                    <div class="placeholder">Loading workflows...</div>
                </div>
            </section>

            <!-- Frameworks Tab -->
            <section id="frameworks" class="tab-content">
                <div class="section-title">Regulatory Frameworks</div>
                
                <div class="frameworks-grid" id="frameworksGrid">
                    <div class="placeholder">Loading frameworks...</div>
                </div>
            </section>

            <!-- Audit Trail Tab -->
            <section id="audit" class="tab-content">
                <div class="section-title">Audit Trail</div>
                
                <div class="audit-filters">
                    <input type="text" id="auditSearch" class="search-input" placeholder="Search audit logs...">
                    <select id="auditTypeFilter" class="filter-select">
                        <option value="all">All Types</option>
                        <option value="scan">Scans</option>
                        <option value="deviation">Deviations</option>
                        <option value="resolution">Resolutions</option>
                        <option value="configuration">Configuration</option>
                    </select>
                </div>

                <div id="auditList" class="audit-list">
                    <div class="placeholder">No audit entries</div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>System Status: <span id="systemStatus">Idle</span> | Active Frameworks: <span id="activeFrameworks">0</span> | Last Updated: <span id="lastUpdate">--</span></p>
        </footer>
    </div>

    <!-- Modal for Deviation Details -->
    <div id="deviationModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2 id="deviationTitle">Deviation Details</h2>
            <div id="deviationDetails" class="deviation-details"></div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="window.tracker.acknowledgeDeviation()">Acknowledge</button>
                <button class="btn btn-success" onclick="window.tracker.resolveDeviation()">Mark Resolved</button>
                <button class="btn btn-secondary" onclick="window.tracker.closeModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Modal for Workflow Details -->
    <div id="workflowModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.tracker.closeModal()">&times;</span>
            <h2 id="workflowTitle">Workflow Details</h2>
            <div id="workflowDetails" class="workflow-details"></div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="window.tracker.scanWorkflow()">Scan Now</button>
                <button class="btn btn-secondary" onclick="window.tracker.closeModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="tracker.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            window.tracker = new ComplianceDeviationTracker();
            window.tracker.initialize();

            // Button handlers
            document.getElementById('startMonitoring').addEventListener('click', () => window.tracker.toggleMonitoring());
            document.getElementById('scanNow').addEventListener('click', () => window.tracker.scanAll());
            document.getElementById('exportReport').addEventListener('click', () => window.tracker.exportReport());

            // Tab handlers
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const tabName = e.target.dataset.tab;
                    
                    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                    document.getElementById(tabName).classList.add('active');
                    
                    window.tracker.onTabChange(tabName);
                });
            });

            // Filter handlers
            document.getElementById('severityFilter')?.addEventListener('change', () => window.tracker.applyFilters());
            document.getElementById('frameworkFilter')?.addEventListener('change', () => window.tracker.applyFilters());
            document.getElementById('statusFilter')?.addEventListener('change', () => window.tracker.applyFilters());
            document.getElementById('auditTypeFilter')?.addEventListener('change', () => window.tracker.filterAuditLog());
            document.getElementById('auditSearch')?.addEventListener('input', () => window.tracker.filterAuditLog());

            // Modal handlers
            document.querySelectorAll('.modal-close').forEach(el => {
                el.addEventListener('click', () => window.tracker.closeModal());
            });
            
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    window.tracker.closeModal();
                }
            });
        });
    </script>
</body>
</html>
